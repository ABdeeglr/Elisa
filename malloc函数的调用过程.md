# malloc 函数的调用过程

调用malloc函数时，系统底层遵循一下几个典型的几个步骤：

1. 搜索空闲内存块，如果合适就将其分配出去
2. 没有合适的空闲内存块，则调用系统调用扩大堆区
3. malloc调用系统调用后转入内核态，虚拟内存系统扩大了虚拟内存，但尚未分配物理内存
4. 系统调用结束后返回 malloc，从内核态切入用户态，此时 malloc 能够找到一块合适的空闲内存

如果需要更细节地了解如何申请内存，阅读[申请内存时底层发生了什么](https://mp.weixin.qq.com/s?__biz=Mzg4OTYzODM4Mw==&mid=2247485719&idx=1&sn=29d47752010326eb02edf6dadd505d4c&source=41#wechat_redirect).